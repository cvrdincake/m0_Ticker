<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Test</title>
</head>
<body>
    <h1>Dashboard Test</h1>
    <div id="status">Loading...</div>
    
    <script>
        // Test basic WebSocket connectivity
        function testWebSocket() {
            try {
                const ws = new WebSocket('ws://localhost:3000/ws');
                
                ws.onopen = function() {
                    document.getElementById('status').innerHTML = 'WebSocket Connected!';
                    console.log('WebSocket connected');
                };
                
                ws.onmessage = function(event) {
                    console.log('Received:', event.data);
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'init') {
                            document.getElementById('status').innerHTML = 'WebSocket Connected and Initial Data Received!';
                        }
                    } catch (e) {
                        console.error('Parse error:', e);
                    }
                };
                
                ws.onerror = function(error) {
                    document.getElementById('status').innerHTML = 'WebSocket Error: ' + error;
                    console.error('WebSocket error:', error);
                };
                
                ws.onclose = function() {
                    document.getElementById('status').innerHTML = 'WebSocket Closed';
                    console.log('WebSocket closed');
                };
            } catch (error) {
                document.getElementById('status').innerHTML = 'WebSocket creation failed: ' + error;
                console.error('WebSocket creation error:', error);
            }
        }
        
        // Test API endpoints
        function testAPI() {
            fetch('/health')
                .then(response => response.json())
                .then(data => console.log('Health check:', data))
                .catch(error => console.error('Health check failed:', error));
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testWebSocket();
            testAPI();
        });
    </script>
</body>
</html>