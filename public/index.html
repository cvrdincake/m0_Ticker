<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OBS Ticker Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/SplitText.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrambleTextPlugin.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="css/themes.css">
  <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
  <div class="app">
    <div class="panel panel--accent">
      <div class="header">
        <div class="title-block">
          <h1>OBS Ticker Dashboard</h1>
          <p class="subtitle">Curate ticker copy, configure overlay styling, and manage presets in one place. Minutes-based intervals and rich text modifiers are supported.</p>
        </div>
        <div class="overlay-chip" title="Click to copy" id="overlayUrlChip">
          <strong>Overlay URL</strong>
          <span id="overlayUrlText">–</span>
        </div>
      </div>

      <div class="status-grid">
        <div class="status-card">
          <div class="status-item"><span class="status-dot" id="statusActive"></span><span>State</span><span class="status-value" id="statusActiveText">Inactive</span></div>
          <div class="status-item"><span>Messages</span><span class="status-value" id="statusMessageCount">0</span></div>
          <div class="status-item"><span class="status-dot" id="statusBrbDot"></span><span>BRB</span><span class="status-value" id="statusBrb">Hidden</span></div>
        </div>
        <div class="status-card">
          <div class="status-item"><span>Last Update</span><span class="status-value" id="statusUpdated">–</span></div>
          <div class="status-item"><span>Server</span><span class="status-value" id="statusServer">Checking…</span></div>
        </div>
        <div class="status-card">
          <div class="status-item" style="flex-wrap: wrap; gap: 6px;">
            <span>Server URL</span>
            <input type="text" id="serverUrl" placeholder="http://127.0.0.1:3000" style="flex:1; min-width: 160px;" />
          </div>
          <div class="status-item"><label><input type="checkbox" id="autoStart" /> Auto-start when messages exist</label></div>
        </div>
      </div>

      <div class="status-actions">
        <button type="button" class="btn btn-ghost" id="exportState">Export state</button>
        <button type="button" class="btn btn-ghost" id="importState">Import state</button>
        <input type="file" id="importStateInput" accept="application/json,.json" hidden />
      </div>
    </div>

    <div class="layout-grid">
      <div class="layout-col layout-col--primary">
        <section class="panel panel--neutral" id="tickerPanel">
          <div>
            <div class="section-title">Ticker Timing</div>
            <div class="section-sub">Control rotation and cooldown cadence. Intervals are stored in minutes (0–60) and converted server-side.</div>
          </div>
          <div class="control-grid">
            <div class="control-group">
              <label for="displayDuration">Display Duration (seconds)</label>
              <input type="number" id="displayDuration" min="2" max="90" step="1" value="5" />
            </div>
            <div class="control-group">
              <label for="intervalMinutes">Interval Between Messages (minutes)</label>
              <input type="number" id="intervalMinutes" min="0" max="60" step="0.01" value="0" />
            </div>
          </div>
          <div class="actions">
            <button class="btn btn-success" id="startBtn">Start</button>
            <button class="btn btn-danger" id="stopBtn">Stop</button>
            <div class="spacer"></div>
            <button class="btn btn-secondary" id="refreshBtn">Refresh</button>
          </div>
        </section>

        <section class="panel panel--neutral" id="messagesPanel">
          <div>
            <div class="section-title">Ticker Messages</div>
            <div class="section-sub">Use modifiers like <code>~~rainbow~~</code>, <code>%%spark%%</code>, <code>^^bounce^^</code>, <code>==neon==</code>, and <code>!!glitch!!</code>. Markdown-style <code>**bold**</code> and <code>*italic*</code> are supported.</div>
          </div>
          <form class="message-composer" id="messageForm">
            <input type="text" id="newMessage" placeholder="Add a ticker message…" autocomplete="off" />
            <button type="submit" class="btn" id="addMessageButton">Add</button>
            <button type="button" class="btn btn-secondary" id="clearMessages">Clear</button>
            <button type="button" class="btn btn-ghost" id="exportMessages">Export</button>
            <button type="button" class="btn btn-ghost" id="importMessages">Import</button>
          </form>
          <div class="message-list" id="messageList">
            <div class="empty-state">No messages yet — add a line above or load a preset.</div>
          </div>
        </section>

        <section class="panel panel--muted" id="presetsPanel">
          <div>
            <div class="section-title">Message Presets</div>
            <div class="section-sub">Save frequently used rotations. Loading replaces the current queue; appending pushes messages to the bottom.</div>
          </div>
          <div class="preset-header">
            <input type="text" id="presetName" placeholder="Preset name" />
            <button class="btn" type="button" id="savePreset">Save Current Messages</button>
          </div>
          <div class="preset-list" id="presetList">
            <div class="empty-state">No presets saved yet.</div>
          </div>
        </section>

        <section class="panel panel--accent" id="scenesPanel">
          <div>
            <div class="section-title">Scene Presets</div>
            <div class="section-sub">Snapshot ticker queues with popup and theme settings so you can recall complete looks for recurring segments.</div>
          </div>
          <div class="scene-header">
            <input type="text" id="sceneName" placeholder="Scene name" />
            <button class="btn" type="button" id="saveScene">Save Scene</button>
          </div>
          <div class="scene-list" id="sceneList">
            <div class="empty-state">No scenes saved yet.</div>
          </div>
        </section>
      </div>

      <div class="layout-col layout-col--secondary">
        <section class="panel panel--accent" id="overlayPanel">
          <div>
            <div class="section-title">Overlay Styling</div>
            <div class="section-sub">Adjust label, highlights, animation preferences, and scale for the browser source preview.</div>
          </div>
          <div class="control-grid">
            <div class="control-group">
              <label for="overlayLabel">Overlay Label</label>
              <input type="text" id="overlayLabel" maxlength="48" />
              <p class="control-hint">Overlay label can be up to 48 characters.</p>
            </div>
            <div class="control-group">
              <label for="overlayAccent">Accent Colour</label>
              <div class="accent-inputs" id="overlayAccentGroup">
                <input type="color" id="overlayAccentPicker" aria-label="Accent colour" value="#38bdf8" />
                <input type="text" id="overlayAccent" placeholder="#38bdf8" autocomplete="off" spellcheck="false" maxlength="64" />
              </div>
              <p class="control-hint" id="overlayAccentHint">Accepts hex (#ff0000), rgb(a), hsl(a), or named colours.</p>
            </div>
            <div class="control-group">
              <label for="overlayAccentSecondary">Accent Colour B</label>
              <div class="accent-inputs" id="overlayAccentSecondaryGroup">
                <input type="color" id="overlayAccentSecondaryPicker" aria-label="Secondary accent colour" value="#f472b6" />
                <input type="text" id="overlayAccentSecondary" placeholder="#f472b6" autocomplete="off" spellcheck="false" maxlength="64" />
              </div>
              <p class="control-hint" id="overlayAccentSecondaryHint">Optional second highlight used by Duotone Fusion and blended gradients.</p>
            </div>
            <div class="control-group">
              <label for="highlightWords">Highlight Words (comma separated)</label>
              <input type="text" id="highlightWords" placeholder="YouTube,Twitch,breaking" maxlength="512" />
              <p class="control-hint" id="highlightWordsHint" aria-live="polite">Highlight words can be up to 512 characters. 512 characters remaining.</p>
            </div>
          </div>
          <div class="control-group">
            <label for="scaleRange">Overlay Scale</label>
            <div class="segment-row" style="flex-wrap: nowrap; gap: 12px; align-items: center;">
              <input type="range" id="scaleRange" min="0.75" max="2.5" step="0.05" value="1.75" />
              <input type="number" id="scaleNumber" min="0.75" max="2.5" step="0.05" value="1.75" style="max-width: 90px;" />
            </div>
          </div>
          <div class="control-group">
            <label for="popupScaleRange">Popup Scale</label>
            <div class="segment-row" style="flex-wrap: nowrap; gap: 12px; align-items: center;">
              <input type="range" id="popupScaleRange" min="0.6" max="1.5" step="0.05" value="1" />
              <input type="number" id="popupScaleNumber" min="0.6" max="1.5" step="0.05" value="1" style="max-width: 90px;" />
            </div>
            <p class="control-hint">Shrink or grow the popup independently of the ticker.</p>
          </div>
          <div class="control-group">
            <label>Position</label>
            <div class="segment-row" id="positionButtons">
              <button type="button" class="segment-button" data-position="bottom">Bottom</button>
              <button type="button" class="segment-button" data-position="top">Top</button>
            </div>
          </div>
          <div class="control-group">
            <label>Animation Mode</label>
            <div class="segment-row" id="modeButtons">
              <button type="button" class="segment-button" data-mode="auto">Auto</button>
              <button type="button" class="segment-button" data-mode="marquee">Marquee</button>
              <button type="button" class="segment-button" data-mode="chunk">Chunk</button>
            </div>
          </div>
          <div class="control-group">
            <label>Theme</label>
              <div class="segment-row" id="themeButtons">
                <button type="button" class="segment-button" data-theme="midnight-glass">Midnight Glass</button>
                <button type="button" class="segment-button" data-theme="aurora-night">Aurora Night</button>
                <button type="button" class="segment-button" data-theme="nexus-grid">Nexus Grid</button>
                <button type="button" class="segment-button" data-theme="zen-flow">Zen Flow</button>
                <button type="button" class="segment-button" data-theme="duotone-fusion">Duotone Fusion</button>
              </div>
              <div class="theme-notes">
                <span><strong>Midnight Glass</strong> frosted panes with ambient PixiJS particles</span>
                <span><strong>Aurora Night</strong> flowing shader ribbons reacting to your accent colours</span>
                <span><strong>Nexus Grid</strong> animated network lattice with responsive nodes</span>
                <span><strong>Zen Flow</strong> tranquil Lottie morphing shapes for calm motion</span>
                <span><strong>Duotone Fusion</strong> bold dual-colour gradients and reactive highlights</span>
              </div>
          </div>
          <div class="toggle-row">
            <label><input type="checkbox" id="accentAnimToggle" checked /> Accent shimmer</label>
            <label><input type="checkbox" id="sparkleToggle" checked /> Sparkle effects</label>
          </div>
          <div class="actions actions--overlay-hint">
            <button class="btn btn-ghost" id="copyOverlay">Copy URL</button>
            <p class="control-hint">Use this in an OBS Browser Source.</p>
          </div>
          <div class="preview-block">
            <div class="preview-toolbar">
              <div>
                <div class="preview-title">Live Preview</div>
                <div class="preview-sub">Embeds the overlay URL above so changes appear instantly.</div>
              </div>
              <div class="preview-actions">
                <button type="button" class="btn btn-secondary" id="reloadPreview">Reload</button>
                <button type="button" class="btn btn-ghost" id="openOverlay">Open in new tab</button>
              </div>
            </div>
            <div class="preview-frame">
              <iframe id="overlayPreview" title="Overlay preview" loading="lazy" sandbox="allow-same-origin allow-scripts"></iframe>
            </div>
          </div>
        </section>

        <section class="panel panel--neutral" id="slatePanel">
          <div>
            <div class="section-title">Segment Slate</div>
            <div class="section-sub">Curate the compact top-right slate with UK time and short notices such as next-up cues or sponsor callouts.</div>
          </div>
          <div class="slate-panel-controls">
            <div class="slate-toggles">
              <label><input type="checkbox" id="slateEnabled" /> Enable segment slate</label>
              <label><input type="checkbox" id="slateShowClock" /> Show clock</label>
            </div>
            <div class="slate-grid">
              <div class="control-group">
                <label for="slateRotation">Rotation Interval (seconds)</label>
                <div class="segment-row" style="gap: 12px; align-items: center;">
                  <input type="range" id="slateRotation" min="4" max="900" step="1" value="12" />
                  <input type="number" id="slateRotationNumber" min="4" max="900" step="1" value="12" style="max-width: 90px;" />
                </div>
                <p class="control-hint">Supports gaps of up to 900 seconds (15 minutes).</p>
              </div>
              <div class="control-group">
                <label for="slateClockLabel">Clock label</label>
                <input type="text" id="slateClockLabel" maxlength="48" placeholder="UK TIME" />
              </div>
              <div class="control-group">
                <label for="slateClockSubtitle">Clock subtitle</label>
                <input type="text" id="slateClockSubtitle" maxlength="200" placeholder="UK time" />
              </div>
              <div class="control-group">
                <label for="slateNextLabel">Next-up label</label>
                <input type="text" id="slateNextLabel" maxlength="48" placeholder="Next up" />
              </div>
              <div class="control-group">
                <label for="slateNextTitle">Next-up title</label>
                <input type="text" id="slateNextTitle" maxlength="64" placeholder="Guest interview" />
              </div>
              <div class="control-group">
                <label for="slateNextSubtitle">Next-up details</label>
                <input type="text" id="slateNextSubtitle" maxlength="200" placeholder="Happening after the break" />
              </div>
              <div class="control-group">
                <label for="slateSponsorLabel">Sponsor label</label>
                <input type="text" id="slateSponsorLabel" maxlength="48" placeholder="Sponsor" />
              </div>
              <div class="control-group">
                <label for="slateSponsorName">Sponsor name</label>
                <input type="text" id="slateSponsorName" maxlength="64" placeholder="Acme Co." />
              </div>
              <div class="control-group">
                <label for="slateSponsorTagline">Sponsor tagline</label>
                <input type="text" id="slateSponsorTagline" maxlength="200" placeholder="Proudly supporting tonight's stream" />
              </div>
              <div class="control-group">
                <label for="slateNotesLabel">Spotlight label</label>
                <input type="text" id="slateNotesLabel" maxlength="48" placeholder="Spotlight" />
              </div>
              <div class="control-group">
                <label for="slateNotes">Spotlight notes (one per line)</label>
                <textarea id="slateNotes" maxlength="1200" placeholder="Follow @channelhandle&#10;Share your questions with #AskLive"></textarea>
                <p class="control-hint">Up to six lines (200 characters each) rotate alongside the clock card.</p>
              </div>
            </div>
            <div class="slate-preview is-empty is-visible" id="slatePreview">
              <div class="slate-preview-row" id="slatePreviewContent">
                <span class="slate-preview-pill">Segment slate</span>
                <div class="slate-preview-title">Add upcoming items or notes to preview the slate.</div>
                <div class="slate-preview-subtitle">Clock and messages will rotate automatically.</div>
                <div class="slate-preview-meta">Rotation preview</div>
              </div>
              <div class="slate-preview-dots" id="slatePreviewDots"></div>
            </div>
          </div>
        </section>

        <section class="panel panel--neutral" id="popupPanel">
          <div>
            <div class="section-title">Popup Message</div>
            <div class="section-sub">Send a top-left callout styled like the ticker. Supports the same text modifiers.</div>
          </div>
          <textarea id="popupText" placeholder="Enter popup message…"></textarea>
          <div class="popup-actions">
            <label class="popup-toggle"><input type="checkbox" id="popupActive" /> Display popup</label>
            <div class="popup-duration">
              <label for="popupDuration">Auto-hide (seconds)</label>
              <input type="number" id="popupDuration" min="0" max="600" step="1" placeholder="Leave blank to stay visible" inputmode="numeric" />
            </div>
            <div class="popup-buttons">
              <button class="btn btn-secondary" type="button" id="clearPopup">Clear</button>
              <button class="btn" type="button" id="savePopup">Update Popup</button>
            </div>
          </div>
          <div class="popup-countdown">
            <label class="popup-countdown-toggle"><input type="checkbox" id="popupCountdownEnabled" /> Append countdown timer</label>
            <div class="popup-countdown-input">
              <label for="popupCountdownTarget">Countdown target</label>
              <input type="datetime-local" id="popupCountdownTarget" />
            </div>
          </div>
          <div class="popup-preview is-empty" id="popupPreview">Popup preview</div>
          <div class="popup-meta" id="popupMeta">Popup hidden</div>
        </section>

        <section class="panel panel--muted" id="brbPanel">
          <div>
            <div class="section-title">BRB Message</div>
            <div class="section-sub">Manage the standby banner shared with the overlay output.</div>
          </div>
          <textarea id="brbText" placeholder="Enter BRB message…"></textarea>
          <div class="brb-actions">
            <label class="brb-toggle"><input type="checkbox" id="brbActive" /> Show BRB message</label>
            <div class="spacer"></div>
            <button class="btn btn-secondary" type="button" id="brbClear">Clear</button>
            <button class="btn" type="button" id="brbSave">Update BRB</button>
          </div>
          <div class="brb-status" id="brbStatus">BRB hidden</div>
        </section>
      </div>
    </div>
  </div>

  <div class="preset-modal" id="presetMessageModal" aria-hidden="true">
    <div class="preset-modal__card" role="dialog" aria-modal="true" aria-labelledby="presetModalTitle" aria-describedby="presetModalHint">
      <div class="preset-modal__title" id="presetModalTitle">Save message to presets</div>
      <div class="preset-modal__message" id="presetModalPreview"><span class="small">Select a message to begin.</span></div>
      <div class="preset-modal__field">
        <label for="presetModalName">Preset name</label>
        <input type="text" class="preset-modal__input" id="presetModalName" maxlength="80" autocomplete="off" spellcheck="false" />
      </div>
      <p class="preset-modal__hint" id="presetModalHint">Preset names can be up to 80 characters.</p>
      <div class="preset-modal__actions">
        <button type="button" class="btn btn-secondary" id="presetModalCancel">Cancel</button>
        <button type="button" class="btn" id="presetModalSave">Save preset</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="js/shared-config.js"></script>
  <script src="js/shared-utils.js"></script>

  <script type="module" src="js/dashboard/main.js"></script>
</body>
</html>
