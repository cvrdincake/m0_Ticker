<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ticker Dashboard - Modern</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Roboto:wght@300;400;500;700;900&family=Poppins:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@300;400;500;700&family=Fira+Code:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/phosphor-icons@1.4.2/src/css/icons.min.css" rel="stylesheet">
  
  <!-- Unified Theme System -->
  <link rel="stylesheet" href="css/unified-theme.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/theme-customizer.css">
  <link rel="stylesheet" href="css/advanced-animations.css">
  <link rel="stylesheet" href="css/enhanced-themes.css">
  <link rel="stylesheet" href="css/enhanced-ux.css">
  
  <style>
    /* ===== DASHBOARD SPECIFIC STYLES ===== */
    
    .dashboard-layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      min-height: 100vh;
    }
    
    /* Sidebar */
    .sidebar {
      background-color: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: var(--z-docked);
    }
    
    .sidebar-header {
      padding: var(--space-6);
      border-bottom: 1px solid var(--border-secondary);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-inverse);
      font-size: var(--text-lg);
      font-weight: var(--font-bold);
    }
    
    .logo-text {
      font-size: var(--text-xl);
      font-weight: var(--font-bold);
      color: var(--text-primary);
    }
    
    /* Status Panel */
    .status-panel {
      margin: var(--space-4);
      padding: var(--space-4);
      background-color: var(--surface);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    
    .connection-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      flex: 1;
    }
    
    .connection-status {
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      color: var(--text-secondary);
    }
    
    /* Navigation */
    .sidebar-nav {
      flex: 1;
      padding: var(--space-4);
    }
    
    .nav-section {
      margin-bottom: var(--space-6);
    }
    
    .nav-section-title {
      font-size: var(--text-xs);
      font-weight: var(--font-semibold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-disabled);
      margin-bottom: var(--space-3);
      padding-left: var(--space-3);
    }
    
    /* Main Content */
    .main-content {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .main-header {
      height: var(--header-height);
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--space-8);
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
    }
    
    .page-title {
      font-size: var(--text-2xl);
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      margin: 0;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    
    /* Content Area */
    .content-area {
      flex: 1;
      padding: var(--space-8);
      background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      min-height: calc(100vh - var(--header-height));
    }
    
    .content-grid {
      display: grid;
      gap: var(--space-8);
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Dashboard View */
    .dashboard-view .content-grid {
      grid-template-columns: 1fr 400px;
      align-items: start;
    }
    
    /* Message Management */
    .message-composer {
      display: flex;
      gap: var(--space-3);
      margin-bottom: var(--space-6);
    }
    
    .message-composer .form-input {
      flex: 1;
    }
    
    .message-list {
      background-color: var(--surface);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      min-height: 400px;
      max-height: 600px;
      overflow-y: auto;
      position: relative;
    }
    
    .message-item {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-secondary);
      transition: var(--transition);
      position: relative;
      cursor: pointer;
    }
    
    .message-item:last-child {
      border-bottom: none;
    }
    
    .message-item:hover {
      background-color: var(--surface-hover);
    }
    
    .message-item.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }
    
    .drag-handle {
      color: var(--text-disabled);
      cursor: grab;
      font-size: var(--text-lg);
    }
    
    .drag-handle:active {
      cursor: grabbing;
    }
    
    .message-content {
      flex: 1;
      min-width: 0;
    }
    
    .message-text {
      font-size: var(--text-sm);
      color: var(--text-primary);
      word-break: break-word;
      line-height: var(--leading-normal);
    }
    
    .message-meta {
      font-size: var(--text-xs);
      color: var(--text-disabled);
      margin-top: var(--space-1);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    
    .message-actions {
      display: flex;
      gap: var(--space-2);
      opacity: 0;
      transform: translateX(8px);
      transition: var(--transition);
    }
    
    .message-item:hover .message-actions {
      opacity: 1;
      transform: translateX(0);
    }
    
    /* Control Panels */
    .control-panel {
      background-color: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      box-shadow: var(--shadow);
    }
    
    .control-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border-secondary);
    }
    
    .control-icon {
      width: 20px;
      height: 20px;
      color: var(--text-secondary);
    }
    
    .control-title {
      font-size: var(--text-lg);
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      margin: 0;
    }
    
    .control-subtitle {
      font-size: var(--text-sm);
      color: var(--text-tertiary);
      margin-top: var(--space-1);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-8);
    }
    
    .stat-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      text-align: center;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--text-primary), var(--text-secondary));
      opacity: 0;
      transition: var(--transition-opacity);
    }
    
    .stat-card:hover::before {
      opacity: 1;
    }
    
    .stat-value {
      font-size: var(--text-3xl);
      font-weight: var(--font-bold);
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }
    
    .stat-label {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--space-3);
    }
    
    .quick-action {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-4);
      background-color: var(--surface);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius);
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
    }
    
    .quick-action:hover {
      background-color: var(--surface-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    
    .quick-action-icon {
      font-size: var(--text-xl);
    }
    
    .quick-action-label {
      font-size: var(--text-xs);
      font-weight: var(--font-medium);
      text-align: center;
    }
    
    /* View Transitions */
    .view {
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition-slow);
      pointer-events: none;
    }
    
    .view.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    
    /* Responsive Design */
    @media (max-width: 1200px) {
      .dashboard-view .content-grid {
        grid-template-columns: 1fr;
        gap: var(--space-6);
      }
    }
    
    /* Quick Theme Buttons */
    .preset-theme-quick {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3);
      background-color: var(--surface);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
      color: var(--text-secondary);
      text-decoration: none;
    }
    
    .preset-theme-quick:hover {
      background-color: var(--surface-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      color: var(--text-primary);
    }
    
    @media (max-width: 768px) {
      .dashboard-layout {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: fixed;
        top: 0;
        left: -280px;
        width: var(--sidebar-width);
        height: 100vh;
        z-index: var(--z-modal);
        transition: var(--transition);
      }
      
      .sidebar.mobile-open {
        left: 0;
        box-shadow: var(--shadow-2xl);
      }
      
      .main-content {
        grid-column: 1;
      }
      
      .content-area {
        padding: var(--space-4);
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 640px) {
      .message-composer {
        flex-direction: column;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .quick-actions {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* ===== OUTPUT PREVIEW STYLES ===== */
    
    .preview-mode-selector {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .btn-group {
      display: flex;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border-primary);
    }
    
    .btn-group .btn {
      border-radius: 0;
      border: none;
      border-right: 1px solid var(--border-primary);
    }
    
    .btn-group .btn:last-child {
      border-right: none;
    }
    
    .btn-group .btn.active {
      background-color: var(--accent);
      color: var(--accent-contrast);
    }
    
    .preview-container {
      background: var(--surface);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
    }
    
    .preview-frame {
      position: relative;
      background: #000;
      aspect-ratio: 16/9;
      width: 100%;
    }
    
    .preview-status-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 32px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--space-3);
      z-index: 10;
      color: white;
      font-size: 12px;
    }
    
    #previewIframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      transform-origin: top left;
      transition: transform 0.3s ease;
    }
    
    .preview-controls {
      display: flex;
      gap: var(--space-2);
    }
    
    .info-card {
      background: var(--surface);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      padding: var(--space-4);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--status-warning);
      animation: pulse 2s infinite;
    }
    
    .status-dot.connected {
      background: var(--status-success);
    }
    
    .status-dot.error {
      background: var(--status-error);
    }
    
    .nav-indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--status-success);
      margin-left: auto;
      opacity: 0.7;
    }
    
    /* Preview responsive scaling */
    .preview-frame[data-scale="0.5"] #previewIframe {
      transform: scale(0.5);
      width: 200%;
      height: 200%;
    }
    
    .preview-frame[data-scale="0.75"] #previewIframe {
      transform: scale(0.75);
      width: 133.33%;
      height: 133.33%;
    }
    
    .preview-frame[data-scale="1"] #previewIframe {
      transform: scale(1);
    }
  </style>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <i class="ph-broadcast ph-bold"></i>
          </div>
          <div class="logo-text">Ticker Pro</div>
        </div>
      </div>
      
      <!-- Connection Status -->
      <div class="status-panel">
        <div class="connection-indicator">
          <div class="status-dot" id="connectionDot"></div>
          <div class="connection-status" id="connectionStatus">Connecting...</div>
        </div>
        <i class="ph-wifi-high ph-bold" id="connectionIcon"></i>
      </div>
      
      <!-- Navigation -->
      <nav class="sidebar-nav" role="navigation" aria-label="Main navigation">
        <div class="nav-section">
          <div class="nav-section-title">Dashboard</div>
          <div class="nav">
            <button class="nav-item active" data-view="dashboard" aria-label="Dashboard Overview">
              <i class="nav-icon ph-house ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Overview</span>
            </button>
            <button class="nav-item" data-view="messages" aria-label="Message Management">
              <i class="nav-icon ph-chat-dots ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Messages</span>
              <div class="nav-badge" id="messageCountBadge">0</div>
            </button>
            <button class="nav-item" data-view="ticker" aria-label="Ticker Control">
              <i class="nav-icon ph-play-circle ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Ticker Control</span>
            </button>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Widgets</div>
          <div class="nav">
            <button class="nav-item" data-view="overlay" aria-label="Overlay Settings">
              <i class="nav-icon ph-monitor ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Overlay</span>
            </button>
            <button class="nav-item" data-view="popup" aria-label="Popup Management">
              <i class="nav-icon ph-app-window ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Popups</span>
            </button>
            <button class="nav-item" data-view="brb" aria-label="BRB Mode">
              <i class="nav-icon ph-pause-circle ph-bold" aria-hidden="true"></i>
              <span class="nav-label">BRB Mode</span>
            </button>
            <button class="nav-item" data-view="themes" aria-label="Theme Customization">
              <i class="nav-icon ph-palette ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Theme Studio</span>
            </button>
            <button class="nav-item" data-view="preview" aria-label="Output Preview">
              <i class="nav-icon ph-television ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Output Preview</span>
              <div class="nav-indicator" id="previewStatusIndicator" aria-hidden="true"></div>
            </button>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <div class="nav">
            <button class="nav-item" data-view="settings" aria-label="Settings">
              <i class="nav-icon ph-gear ph-bold" aria-hidden="true"></i>
              <span class="nav-label">Settings</span>
            </button>
            <button class="nav-item" id="exportDataBtn">
              <i class="nav-icon ph-download ph-bold"></i>
              <span class="nav-label">Export Data</span>
            </button>
          </div>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="main-header">
        <div class="flex items-center gap-4">
          <button class="btn btn-ghost btn-icon-only md:hidden" id="sidebarToggle">
            <i class="ph-list ph-bold"></i>
          </button>
          <h1 class="page-title" id="pageTitle">Dashboard Overview</h1>
        </div>
        
        <div class="header-actions">
          <div class="flex items-center gap-2 mr-4">
            <label class="text-sm text-secondary">Theme:</label>
            <select class="form-input w-32" id="themeSelector">
              <option value="dark">Dark</option>
              <option value="glass">Glass</option>
              <option value="cyberpunk">Cyberpunk</option>
              <option value="professional">Professional</option>
            </select>
          </div>
          <button class="btn btn-ghost" id="refreshBtn">
            <i class="ph-arrows-clockwise ph-bold"></i>
            <span class="sm:hidden">Refresh</span>
          </button>
          <button class="btn btn-primary" id="quickAddBtn">
            <i class="ph-plus ph-bold"></i>
            <span class="sm:hidden">Quick Add</span>
          </button>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view active dashboard-view">
          <!-- Stats Overview -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalMessages">0</div>
              <div class="stat-label">Total Messages</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="tickerStatus">Stopped</div>
              <div class="stat-label">Ticker Status</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="uptime">00:00:00</div>
              <div class="stat-label">Uptime</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="messagesShown">0</div>
              <div class="stat-label">Messages Shown</div>
            </div>
          </div>
          
          <div class="content-grid">
            <!-- Main Content -->
            <div>
              <!-- Message Management Card -->
              <div class="card card-elevated">
                <div class="card-header">
                  <div class="flex items-center justify-between">
                    <div>
                      <h2 class="card-title flex items-center gap-3">
                        <i class="ph-chat-dots ph-bold"></i>
                        Ticker Messages
                        <span class="help-icon tooltip" data-tooltip="Manage your ticker message queue. Messages rotate automatically when ticker is active." onclick="toggleHelp('messages-help')">?</span>
                      </h2>
                      <p class="card-subtitle">Manage your ticker message queue</p>
                      <div id="messages-help" class="help-panel">
                        <strong>Message Management Tips:</strong><br>
                        • Messages display for the duration you set in Ticker Control<br>
                        • Use Ctrl+K from anywhere to quickly add messages<br>
                        • Drag messages to reorder them<br>
                        • Click the eye icon to preview messages
                      </div>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="history-controls">
                        <button class="history-btn tooltip" id="undoBtn" data-tooltip="Undo last action (Ctrl+Z)" disabled>
                          <i class="ph-arrow-counter-clockwise ph-bold"></i>
                        </button>
                        <button class="history-btn tooltip" id="redoBtn" data-tooltip="Redo last action (Ctrl+Y)" disabled>
                          <i class="ph-arrow-clockwise ph-bold"></i>
                        </button>
                        <span class="history-indicator" id="historyIndicator">No changes</span>
                      </div>
                      <div class="badge badge-primary" id="messageCount">0 messages</div>
                    </div>
                  </div>
                </div>
                
                <div class="card-body">
                  <!-- Message Composer -->
                  <form class="message-composer" id="messageForm">
                    <input 
                      type="text" 
                      class="form-input tooltip" 
                      id="messageInput" 
                      placeholder="Enter your ticker message..."
                      maxlength="280"
                      data-tooltip="Add messages to your ticker queue. Max 280 characters. Press Ctrl+K from anywhere to focus this field."
                    >
                    <button type="submit" class="btn btn-primary tooltip" data-tooltip="Add message to queue">
                      <i class="ph-plus ph-bold"></i>
                      Add
                    </button>
                  </form>
                  
                  <!-- Message List -->
                  <div class="message-list" id="messageList">
                    <div class="empty-state">
                      <div class="empty-icon">
                        <i class="ph-chat-dots ph-light"></i>
                      </div>
                      <div class="empty-title">No messages yet</div>
                      <div class="empty-description">
                        Add your first ticker message above to get started
                      </div>
                    </div>
                  </div>
                  
                  <!-- Message Actions -->
                  <div class="flex gap-3 pt-4" style="border-top: 1px solid var(--border-secondary);">
                    <button class="btn btn-error" id="clearAllBtn">
                      <i class="ph-trash ph-bold"></i>
                      Clear All
                    </button>
                    <button class="btn btn-secondary" id="exportMessagesBtn">
                      <i class="ph-download ph-bold"></i>
                      Export
                    </button>
                    <button class="btn btn-secondary" id="importMessagesBtn">
                      <i class="ph-upload ph-bold"></i>
                      Import
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sidebar -->
            <div class="flex flex-col gap-6">
              <!-- Ticker Control -->
              <div class="control-panel">
                <div class="control-header">
                  <i class="control-icon ph-play-circle ph-bold"></i>
                  <div>
                    <h3 class="control-title">Ticker Control</h3>
                    <p class="control-subtitle">Start and configure your ticker</p>
                  </div>
                </div>
                
                <div class="flex flex-col gap-4">
                  <div class="form-group">
                    <label class="form-label" for="durationInput">
                      <i class="ph-timer ph-bold"></i>
                      Duration (seconds)
                    </label>
                    <input 
                      type="number" 
                      class="form-input" 
                      id="durationInput" 
                      value="5" 
                      min="1" 
                      max="60"
                    >
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label" for="intervalInput">
                      <i class="ph-clock ph-bold"></i>
                      Interval (minutes)
                    </label>
                    <input 
                      type="number" 
                      class="form-input" 
                      id="intervalInput" 
                      value="0" 
                      min="0" 
                      max="60" 
                      step="0.1"
                    >
                  </div>
                  
                  <div class="btn-group">
                    <button class="btn btn-success" id="startTickerBtn">
                      <i class="ph-play ph-bold"></i>
                      Start
                    </button>
                    <button class="btn btn-error" id="stopTickerBtn">
                      <i class="ph-stop ph-bold"></i>
                      Stop
                    </button>
                  </div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="control-panel">
                <div class="control-header">
                  <i class="control-icon ph-lightning ph-bold"></i>
                  <div>
                    <h3 class="control-title">Quick Actions</h3>
                    <p class="control-subtitle">Common tasks and shortcuts</p>
                  </div>
                </div>
                
                <div class="quick-actions">
                  <button class="quick-action" id="testOverlayBtn">
                    <i class="quick-action-icon ph-eye ph-bold"></i>
                    <span class="quick-action-label">Test Overlay</span>
                  </button>
                  <button class="quick-action" id="openOverlayBtn">
                    <i class="quick-action-icon ph-arrow-square-out ph-bold"></i>
                    <span class="quick-action-label">Open Overlay</span>
                  </button>
                  <button class="quick-action" id="showPopupBtn">
                    <i class="quick-action-icon ph-app-window ph-bold"></i>
                    <span class="quick-action-label">Test Popup</span>
                  </button>
                  <button class="quick-action" id="toggleBrbBtn">
                    <i class="quick-action-icon ph-pause-circle ph-bold"></i>
                    <span class="quick-action-label">Toggle BRB</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Other Views (Placeholders) -->
        <div id="messages-view" class="view">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Advanced Message Management</h2>
            </div>
            <div class="card-body">
              <p>Advanced message features coming soon...</p>
            </div>
          </div>
        </div>

        <div id="ticker-view" class="view">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Ticker Configuration</h2>
            </div>
            <div class="card-body">
              <p>Advanced ticker controls coming soon...</p>
            </div>
          </div>
        </div>

        <div id="overlay-view" class="view">
          <div class="card">
            <div class="card-header">
              <div>
                <h2 class="card-title flex items-center gap-3">
                  <i class="ph-monitor ph-bold"></i>
                  Overlay Settings
                  <span class="help-icon tooltip" data-tooltip="Configure your overlay appearance and branding" onclick="toggleHelp('overlay-help')">?</span>
                </h2>
                <p class="card-subtitle">Customize overlay appearance and branding</p>
                <div id="overlay-help" class="help-panel">
                  <strong>Overlay Configuration:</strong><br>
                  • Upload a logo to brand your ticker and popups<br>
                  • Adjust opacity, scale, and positioning<br>
                  • Changes apply instantly to live overlay<br>
                  • Logo should be PNG/SVG for best quality
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <!-- Logo Upload Section -->
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title flex items-center gap-2">
                      <i class="ph-image ph-bold"></i>
                      Brand Logo
                    </h3>
                    <p class="card-subtitle">Upload your logo for subtle branding</p>
                  </div>
                  <div class="card-body">
                    <div class="logo-upload-area" id="logoUploadArea">
                      <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
                      <div id="logoUploadContent">
                        <i class="ph-upload ph-bold text-4xl text-secondary mb-3"></i>
                        <p class="text-lg font-medium mb-2">Drop logo here or click to upload</p>
                        <p class="text-sm text-secondary">PNG, JPG, SVG up to 2MB</p>
                        <p class="text-xs text-muted mt-2">Recommended: 200x60px transparent PNG</p>
                      </div>
                      <img id="logoPreview" class="logo-preview" style="display: none;" alt="Logo preview">
                    </div>
                    
                    <div class="logo-controls" id="logoControls" style="display: none;">
                      <button class="btn btn-sm btn-ghost tooltip" id="logoRemoveBtn" data-tooltip="Remove logo">
                        <i class="ph-trash ph-bold"></i>
                        Remove
                      </button>
                      <button class="btn btn-sm btn-ghost tooltip" id="logoRepositionBtn" data-tooltip="Adjust logo position">
                        <i class="ph-arrows-out ph-bold"></i>
                        Position
                      </button>
                    </div>
                    
                    <!-- Logo Position Settings -->
                    <div id="logoPositionSettings" style="display: none;" class="mt-4 p-4 bg-surface rounded-lg border border-primary">
                      <h4 class="font-medium mb-3">Logo Position</h4>
                      <div class="grid grid-cols-2 gap-3">
                        <div>
                          <label class="form-label">Horizontal Position</label>
                          <select class="form-input" id="logoHorizontalPos">
                            <option value="left">Left</option>
                            <option value="center">Center</option>
                            <option value="right" selected>Right</option>
                          </select>
                        </div>
                        <div>
                          <label class="form-label">Vertical Position</label>
                          <select class="form-input" id="logoVerticalPos">
                            <option value="top">Top</option>
                            <option value="middle">Middle</option>
                            <option value="bottom" selected>Bottom</option>
                          </select>
                        </div>
                        <div>
                          <label class="form-label">Opacity (%)</label>
                          <input type="range" class="form-input" id="logoOpacity" min="10" max="100" value="70">
                        </div>
                        <div>
                          <label class="form-label">Scale (%)</label>
                          <input type="range" class="form-input" id="logoScale" min="50" max="150" value="100">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Overlay Appearance -->
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title flex items-center gap-2">
                      <i class="ph-palette ph-bold"></i>
                      Appearance
                    </h3>
                    <p class="card-subtitle">Visual settings and animations</p>
                  </div>
                  <div class="card-body space-y-4">
                    <div class="form-group">
                      <label class="form-label tooltip" data-tooltip="Main overlay label text">
                        Label Text
                      </label>
                      <input type="text" class="form-input" id="overlayLabelInput" value="LIVE" maxlength="24">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label tooltip" data-tooltip="Primary accent color for highlights">
                        Primary Color
                      </label>
                      <input type="color" class="color-picker-input" id="overlayPrimaryColor" value="#ef4444">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label tooltip" data-tooltip="Secondary accent color for gradients">
                        Secondary Color
                      </label>
                      <input type="color" class="color-picker-input" id="overlaySecondaryColor" value="#f472b6">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label tooltip" data-tooltip="Overlay size multiplier">
                        Scale (1.0 = 100%)
                      </label>
                      <input type="range" class="form-input" id="overlayScaleInput" min="0.5" max="3.0" step="0.1" value="1.75">
                      <span class="text-sm text-secondary" id="overlayScaleDisplay">175%</span>
                    </div>
                    
                    <div class="flex items-center gap-4">
                      <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="overlayAnimationsEnabled" checked>
                        <span class="tooltip" data-tooltip="Enable smooth animations and transitions">Enable Animations</span>
                      </label>
                      <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="overlaySparkleEnabled" checked>
                        <span class="tooltip" data-tooltip="Add sparkle effects to accents">Sparkle Effects</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Preview and Actions -->
              <div class="mt-6 p-4 bg-surface rounded-lg border border-primary">
                <div class="flex justify-between items-center">
                  <div>
                    <h4 class="font-medium text-primary">Live Preview</h4>
                    <p class="text-sm text-secondary">Changes apply instantly to your overlay</p>
                  </div>
                  <div class="flex gap-2">
                    <button class="btn btn-ghost tooltip" id="overlayResetBtn" data-tooltip="Reset to default settings">
                      <i class="ph-arrow-counter-clockwise ph-bold"></i>
                      Reset
                    </button>
                    <button class="btn btn-primary tooltip" id="overlayTestBtn" data-tooltip="Test overlay with sample data">
                      <i class="ph-play ph-bold"></i>
                      Test Overlay
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="popup-view" class="view">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Popup Management</h2>
            </div>
            <div class="card-body">
              <p>Popup configuration coming soon...</p>
            </div>
          </div>
        </div>

        <div id="brb-view" class="view">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">BRB Mode</h2>
            </div>
            <div class="card-body">
              <p>BRB configuration coming soon...</p>
            </div>
          </div>
        </div>

        <div id="themes-view" class="view">
          <div class="card">
            <div class="card-header">
              <div>
                <h2 class="card-title flex items-center gap-3">
                  <i class="ph-palette ph-bold"></i>
                  Theme Studio
                  <span class="help-icon tooltip" data-tooltip="Create and manage custom themes for your dashboard" onclick="toggleHelp('themes-help')">?</span>
                </h2>
                <p class="card-subtitle">Customize your dashboard appearance with live preview</p>
                <div id="themes-help" class="help-panel">
                  <strong>Theme System:</strong><br>
                  • Choose from preset themes or create custom ones<br>
                  • All changes apply instantly with live preview<br>
                  • Save custom themes for later use<br>
                  • Export/import theme configurations
                </div>
              </div>
            </div>
            <div class="card-body">
              
              <!-- Theme Preset Gallery -->
              <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                  <i class="ph-swatches ph-bold"></i>
                  Theme Presets
                </h3>
                <div class="theme-preset-grid">
                  <div class="theme-preset-card" data-theme="dark">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: #000000;"></div>
                        <div class="theme-preview-color" style="background: #1a1a1a;"></div>
                        <div class="theme-preview-color" style="background: #3b82f6;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Dark Professional</div>
                    <div class="theme-preset-description">Clean dark theme for professional streaming</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('dark')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div class="theme-preset-card" data-theme="glass">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: linear-gradient(135deg, #0a0a0a, #1a1a1a);"></div>
                        <div class="theme-preview-color" style="background: rgba(255,255,255,0.1);"></div>
                        <div class="theme-preview-color" style="background: #60a5fa;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Glass Morphism</div>
                    <div class="theme-preset-description">Modern glass effect with blur and transparency</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('glass')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div class="theme-preset-card" data-theme="cyberpunk">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: #0a0a0f;"></div>
                        <div class="theme-preview-color" style="background: #00ff88;"></div>
                        <div class="theme-preview-color" style="background: #ff0088;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Cyberpunk RGB</div>
                    <div class="theme-preset-description">Futuristic neon theme with glow effects</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('cyberpunk')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div class="theme-preset-card" data-theme="professional">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: #ffffff;"></div>
                        <div class="theme-preview-color" style="background: #f8fafc;"></div>
                        <div class="theme-preview-color" style="background: #2563eb;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Light Professional</div>
                    <div class="theme-preset-description">Clean light theme for daytime streaming</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('professional')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div class="theme-preset-card" data-theme="gaming">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: #0d1117;"></div>
                        <div class="theme-preview-color" style="background: #00ff88;"></div>
                        <div class="theme-preview-color" style="background: #8b5cf6;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Gaming RGB</div>
                    <div class="theme-preset-description">High contrast gaming theme with RGB accents</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('gaming')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div class="theme-preset-card" data-theme="minimal">
                    <div class="theme-preview">
                      <div class="theme-preview-colors">
                        <div class="theme-preview-color" style="background: #fafafa;"></div>
                        <div class="theme-preview-color" style="background: #e5e5e5;"></div>
                        <div class="theme-preview-color" style="background: #404040;"></div>
                      </div>
                    </div>
                    <div class="theme-preset-name">Minimal Mono</div>
                    <div class="theme-preset-description">Ultra-clean monochrome minimalist theme</div>
                    <div class="theme-preset-actions">
                      <button class="btn btn-xs btn-ghost tooltip" data-tooltip="Apply theme" onclick="applyPresetTheme('minimal')">
                        <i class="ph-check ph-bold"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Custom Theme Builder -->
              <div class="theme-builder">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-lg font-semibold flex items-center gap-2">
                    <i class="ph-wrench ph-bold"></i>
                    Custom Theme Builder
                  </h3>
                  <div class="flex gap-2">
                    <button class="btn btn-sm btn-ghost tooltip" id="saveThemeBtn" data-tooltip="Save current theme">
                      <i class="ph-floppy-disk ph-bold"></i>
                      Save Theme
                    </button>
                    <button class="btn btn-sm btn-ghost tooltip" id="exportThemeBtn" data-tooltip="Export theme file">
                      <i class="ph-download ph-bold"></i>
                      Export
                    </button>
                    <button class="btn btn-sm btn-ghost tooltip" id="importThemeBtn" data-tooltip="Import theme file">
                      <i class="ph-upload ph-bold"></i>
                      Import
                    </button>
                  </div>
                </div>
                
                <div class="color-picker-group">
                  <div class="color-picker-item">
                    <div class="color-picker-label">Primary Background</div>
                    <input type="color" class="color-picker-input" id="customBgPrimary" value="#000000">
                  </div>
                  <div class="color-picker-item">
                    <div class="color-picker-label">Secondary Background</div>
                    <input type="color" class="color-picker-input" id="customBgSecondary" value="#1a1a1a">
                  </div>
                  <div class="color-picker-item">
                    <div class="color-picker-label">Accent Color</div>
                    <input type="color" class="color-picker-input" id="customAccent" value="#3b82f6">
                  </div>
                  <div class="color-picker-item">
                    <div class="color-picker-label">Text Primary</div>
                    <input type="color" class="color-picker-input" id="customTextPrimary" value="#ffffff">
                  </div>
                  <div class="color-picker-item">
                    <div class="color-picker-label">Text Secondary</div>
                    <input type="color" class="color-picker-input" id="customTextSecondary" value="#a1a1aa">
                  </div>
                  <div class="color-picker-item">
                    <div class="color-picker-label">Border Color</div>
                    <input type="color" class="color-picker-input" id="customBorder" value="#27272a">
                  </div>
                </div>
                
                <div class="mt-4 flex justify-between items-center">
                  <div class="text-sm text-secondary">
                    Changes apply instantly • <span id="themePreviewStatus">Ready</span>
                  </div>
                  <button class="btn btn-primary" id="applyCustomThemeBtn">
                    <i class="ph-check ph-bold"></i>
                    Apply Custom Theme
                  </button>
                </div>
              </div>
              
              <!-- Advanced Theme Customizer -->
              <div class="mt-6 p-4 bg-surface rounded-lg border border-primary">
                <div class="flex items-center justify-center">
                  <button class="btn btn-primary btn-lg" onclick="window.themeCustomizer?.open()">
                    <i class="ph-palette ph-bold"></i>
                    Open Advanced Theme Customizer
                  </button>
                </div>
                <p class="text-center text-sm text-secondary mt-2">
                  Access the full theme customizer with fonts, animations, and advanced options
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Output Preview View -->
        <div id="preview-view" class="view">
          <div class="card">
            <div class="card-header">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="card-title flex items-center gap-3">
                    <i class="ph-television ph-bold"></i>
                    Output Preview
                  </h2>
                  <p class="card-subtitle">Live preview of your ticker and overlay output</p>
                </div>
                <div class="flex items-center gap-3">
                  <div class="preview-controls">
                    <button class="btn btn-ghost btn-sm" id="previewRefreshBtn" title="Refresh Preview">
                      <i class="ph-arrow-clockwise ph-bold"></i>
                    </button>
                    <button class="btn btn-ghost btn-sm" id="previewFullscreenBtn" title="Open in New Window">
                      <i class="ph-arrow-square-out ph-bold"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-body">
              <!-- Preview Mode Selector -->
              <div class="preview-mode-selector mb-6">
                <div class="btn-group">
                  <button class="btn btn-sm active" data-preview-mode="overlay" id="previewModeOverlay">
                    <i class="ph-monitor ph-bold"></i>
                    Overlay
                  </button>
                  <button class="btn btn-sm" data-preview-mode="optimized" id="previewModeOptimized">
                    <i class="ph-lightning ph-bold"></i>
                    Optimized
                  </button>
                </div>
                <div class="ml-auto flex items-center gap-2">
                  <span class="text-sm text-secondary">Scale:</span>
                  <select class="form-input w-20" id="previewScale">
                    <option value="0.5">50%</option>
                    <option value="0.75" selected>75%</option>
                    <option value="1">100%</option>
                  </select>
                </div>
              </div>

              <!-- Preview Container -->
              <div class="preview-container">
                <div class="preview-container preview-container-enhanced">
                  <div class="preview-frame">
                  <div class="preview-status-bar">
                    <div class="flex items-center gap-2">
                      <div class="status-dot" id="previewStatusDot"></div>
                      <span class="text-xs" id="previewStatusText">Loading preview...</span>
                    </div>
                    <div class="text-xs text-secondary" id="previewDimensions">1920 × 1080</div>
                  </div>
                  <iframe 
                    id="previewIframe" 
                    src="output.html"
                    frameborder="0"
                    allow="autoplay"
                    sandbox="allow-scripts allow-same-origin"
                    loading="lazy"
                  ></iframe>
                </div>
              </div>

              <!-- Preview Information -->
              <div class="preview-info mt-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="info-card">
                    <div class="flex items-center gap-2 mb-2">
                      <i class="ph-link ph-bold text-primary"></i>
                      <span class="font-medium">Direct Link</span>
                    </div>
                    <div class="text-xs text-secondary break-all" id="previewDirectLink">
                      http://localhost:3000/ticker/output.html
                    </div>
                  </div>
                  <div class="info-card">
                    <div class="flex items-center gap-2 mb-2">
                      <i class="ph-eye ph-bold text-success"></i>
                      <span class="font-medium">OBS Ready</span>
                    </div>
                    <div class="text-xs text-secondary">
                      Browser Source compatible
                    </div>
                  </div>
                  <div class="info-card">
                    <div class="flex items-center gap-2 mb-2">
                      <i class="ph-lightning ph-bold text-warning"></i>
                      <span class="font-medium">Real-time</span>
                    </div>
                    <div class="text-xs text-secondary">
                      Auto-updates with changes
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="settings-view" class="view">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Settings</h2>
            </div>
            <div class="card-body">
              <p>Application settings coming soon...</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="flex flex-col items-center gap-4">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Loading...</div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" style="position: fixed; top: var(--space-6); right: var(--space-6); z-index: var(--z-toast); display: flex; flex-direction: column; gap: var(--space-3);"></div>

  <!-- Theme Customizer Script -->
  <script src="js/theme-customizer.js"></script>
  
  <script>
    // Global state
    const state = {
      messages: [],
      isRunning: false,
      websocket: null,
      connected: false,
      currentView: 'dashboard',
      stats: {
        uptime: 0,
        messagesShown: 0
      },
      // Undo/Redo system
      history: {
        stack: [],
        currentIndex: -1,
        maxSize: 50
      },
      // Logo settings
      logo: {
        url: null,
        position: { horizontal: 'right', vertical: 'bottom' },
        opacity: 70,
        scale: 100
      }
    };

    const elements = {
      // Navigation
      sidebar: document.getElementById('sidebar'),
      sidebarToggle: document.getElementById('sidebarToggle'),
      navItems: document.querySelectorAll('.nav-item[data-view]'),
      pageTitle: document.getElementById('pageTitle'),
      
      // Connection
      connectionDot: document.getElementById('connectionDot'),
      connectionStatus: document.getElementById('connectionStatus'),
      connectionIcon: document.getElementById('connectionIcon'),
      
      // Messages
      messageForm: document.getElementById('messageForm'),
      messageInput: document.getElementById('messageInput'),
      messageList: document.getElementById('messageList'),
      messageCount: document.getElementById('messageCount'),
      messageCountBadge: document.getElementById('messageCountBadge'),
      
      // Ticker Control
      durationInput: document.getElementById('durationInput'),
      intervalInput: document.getElementById('intervalInput'),
      startTickerBtn: document.getElementById('startTickerBtn'),
      stopTickerBtn: document.getElementById('stopTickerBtn'),
      
      // Stats
      totalMessages: document.getElementById('totalMessages'),
      tickerStatus: document.getElementById('tickerStatus'),
      uptime: document.getElementById('uptime'),
      messagesShown: document.getElementById('messagesShown'),
      
      // Actions
      refreshBtn: document.getElementById('refreshBtn'),
      quickAddBtn: document.getElementById('quickAddBtn'),
      clearAllBtn: document.getElementById('clearAllBtn'),
      testOverlayBtn: document.getElementById('testOverlayBtn'),
      openOverlayBtn: document.getElementById('openOverlayBtn'),
      showPopupBtn: document.getElementById('showPopupBtn'),
      toggleBrbBtn: document.getElementById('toggleBrbBtn'),
      exportDataBtn: document.getElementById('exportDataBtn'),
      exportMessagesBtn: document.getElementById('exportMessagesBtn'),
      importMessagesBtn: document.getElementById('importMessagesBtn'),
      
      // Preview
      previewIframe: document.getElementById('previewIframe'),
      previewModeOverlay: document.getElementById('previewModeOverlay'),
      previewModeOptimized: document.getElementById('previewModeOptimized'),
      previewScale: document.getElementById('previewScale'),
      previewRefreshBtn: document.getElementById('previewRefreshBtn'),
      previewFullscreenBtn: document.getElementById('previewFullscreenBtn'),
      previewStatusDot: document.getElementById('previewStatusDot'),
      previewStatusText: document.getElementById('previewStatusText'),
      previewStatusIndicator: document.getElementById('previewStatusIndicator'),
      previewDirectLink: document.getElementById('previewDirectLink'),
      previewDimensions: document.getElementById('previewDimensions'),
      
      // Theme controls
      themeSelector: document.getElementById('themeSelector'),
      
      // Undo/Redo controls
      undoBtn: document.getElementById('undoBtn'),
      redoBtn: document.getElementById('redoBtn'),
      historyIndicator: document.getElementById('historyIndicator'),
      
      // Logo upload
      logoFileInput: document.getElementById('logoFileInput'),
      logoUploadArea: document.getElementById('logoUploadArea'),
      logoPreview: document.getElementById('logoPreview'),
      logoControls: document.getElementById('logoControls'),
      logoRemoveBtn: document.getElementById('logoRemoveBtn'),
      logoRepositionBtn: document.getElementById('logoRepositionBtn'),
      logoPositionSettings: document.getElementById('logoPositionSettings'),
      
      // Custom theme builder
      saveThemeBtn: document.getElementById('saveThemeBtn'),
      exportThemeBtn: document.getElementById('exportThemeBtn'),
      importThemeBtn: document.getElementById('importThemeBtn'),
      applyCustomThemeBtn: document.getElementById('applyCustomThemeBtn'),
      
      // UI
      loadingOverlay: document.getElementById('loadingOverlay'),
      loadingText: document.getElementById('loadingText'),
      toastContainer: document.getElementById('toastContainer'),
      views: document.querySelectorAll('.view')
    };

    // Navigation system
    function initNavigation() {
      elements.navItems.forEach(item => {
        item.addEventListener('click', () => {
          const viewName = item.getAttribute('data-view');
          showView(viewName);
        });
      });

      elements.sidebarToggle?.addEventListener('click', () => {
        elements.sidebar.classList.toggle('mobile-open');
      });
    }

    function showView(viewName) {
      // Update active nav item
      elements.navItems.forEach(item => {
        item.classList.remove('active');
      });
      
      const activeNav = document.querySelector(`.nav-item[data-view="${viewName}"]`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
      
      // Update page title
      const titles = {
        'dashboard': 'Dashboard Overview',
        'messages': 'Message Management',
        'ticker': 'Ticker Control',
        'overlay': 'Overlay Settings',
        'popup': 'Popup Management',
        'brb': 'BRB Mode',
        'themes': 'Theme Customization',
        'preview': 'Output Preview',
        'settings': 'Settings'
      };
      
      elements.pageTitle.textContent = titles[viewName] || 'Dashboard';
      
      // Show/hide views with animation
      elements.views.forEach(view => {
        view.classList.remove('active');
      });
      
      const activeView = document.getElementById(viewName + '-view');
      if (activeView) {
        setTimeout(() => {
          activeView.classList.add('active');
        }, 50);
      }
      
      state.currentView = viewName;
      
      // Close mobile sidebar
      elements.sidebar.classList.remove('mobile-open');
    }

    // WebSocket functions
    function connectWebSocket() {
      if (state.websocket) {
        state.websocket.close();
      }

      try {
        showLoading('Connecting to server...');
        updateConnectionStatus('connecting', 'Connecting...', 'ph-wifi-slash');
        
        const wsUrl = 'ws://localhost:3000/ws';
        state.websocket = new WebSocket(wsUrl);
        
        state.websocket.onopen = function() {
          hideLoading();
          updateConnectionStatus('connected', 'Connected', 'ph-wifi-high');
          state.connected = true;
          showToast('Connected to server', 'success');
          startUptimeCounter();
        };
        
        state.websocket.onmessage = function(event) {
          try {
            const data = JSON.parse(event.data);
            handleWebSocketMessage(data);
          } catch (error) {
            console.error('Error parsing WebSocket message:', error);
          }
        };
        
        state.websocket.onclose = function() {
          updateConnectionStatus('disconnected', 'Disconnected', 'ph-wifi-x');
          state.connected = false;
          hideLoading();
          
          setTimeout(connectWebSocket, 3000);
        };
        
        state.websocket.onerror = function(error) {
          hideLoading();
          updateConnectionStatus('error', 'Error', 'ph-wifi-x');
          console.error('WebSocket error:', error);
          showToast('Connection failed', 'error');
        };
        
      } catch (error) {
        hideLoading();
        updateConnectionStatus('error', 'Failed to connect', 'ph-wifi-x');
        showToast('Failed to connect: ' + error.message, 'error');
      }
    }

    function sendWebSocketMessage(type, data) {
      if (!state.websocket || state.websocket.readyState !== WebSocket.OPEN) {
        showToast('Not connected to server', 'error');
        return false;
      }
      
      try {
        const message = { type: type, data: data || {} };
        state.websocket.send(JSON.stringify(message));
        return true;
      } catch (error) {
        showToast('Failed to send message: ' + error.message, 'error');
        return false;
      }
    }

    function handleWebSocketMessage(message) {
      switch (message.type) {
        case 'state-update':
          if (message.data && message.data.messages) {
            state.messages = message.data.messages;
            renderMessages();
            updateStats();
          }
          break;
        case 'ticker-status':
          state.isRunning = message.data.isRunning;
          updateTickerControls();
          updateStats();
          break;
        default:
          console.log('Unknown message type:', message.type);
      }
    }

    // UI Update functions
    function updateConnectionStatus(status, text, icon) {
      elements.connectionStatus.textContent = text;
      elements.connectionIcon.className = `${icon} ph-bold`;
      
      elements.connectionDot.className = 'status-dot';
      if (status === 'connected') {
        elements.connectionDot.classList.add('success');
      } else if (status === 'error') {
        elements.connectionDot.classList.add('error');
      }
    }

    function showLoading(text = 'Loading...') {
      elements.loadingText.textContent = text;
      elements.loadingOverlay.classList.add('show');
    }

    function hideLoading() {
      elements.loadingOverlay.classList.remove('show');
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast show animate-slide-right`;
      
      const icons = {
        success: 'ph-check-circle ph-bold',
        error: 'ph-x-circle ph-bold',
        info: 'ph-info ph-bold',
        warning: 'ph-warning ph-bold'
      };
      
      toast.innerHTML = `
        <i class="toast-icon ${icons[type] || icons.info}" style="color: var(--${type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'});"></i>
        <div class="toast-content">${escapeHtml(message)}</div>
        <button class="toast-close" aria-label="Close">
          <i class="ph-x ph-bold"></i>
        </button>
      `;
      
      elements.toastContainer.appendChild(toast);
      
      // Auto hide after 4 seconds
      const hideTimer = setTimeout(() => {
        hideToast(toast);
      }, 4000);
      
      // Click to dismiss
      toast.querySelector('.toast-close').addEventListener('click', () => {
        clearTimeout(hideTimer);
        hideToast(toast);
      });
    }

    // Make showToast available globally
    window.showToast = showToast;

    function hideToast(toast) {
      toast.classList.remove('show');
      toast.classList.add('animate-slide-right');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }

    function renderMessages() {
      if (state.messages.length === 0) {
        elements.messageList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">
              <i class="ph-chat-dots ph-light"></i>
            </div>
            <div class="empty-title">No messages yet</div>
            <div class="empty-description">
              Add your first ticker message above to get started
            </div>
          </div>
        `;
        return;
      }
      
      let html = '';
      state.messages.forEach((message, index) => {
        const text = message.text || message;
        html += `
          <div class="message-item animate-slide-up" style="animation-delay: ${index * 50}ms" data-index="${index}">
            <i class="drag-handle ph-dots-six-vertical ph-bold"></i>
            <div class="message-content">
              <div class="message-text">${escapeHtml(text)}</div>
              <div class="message-meta">
                <span>Message #${index + 1}</span>
                <span>•</span>
                <span>${text.length} characters</span>
              </div>
            </div>
            <div class="message-actions">
              <button class="btn btn-ghost btn-sm" onclick="editMessage(${index})" title="Edit">
                <i class="ph-pencil ph-bold"></i>
              </button>
              <button class="btn btn-ghost btn-sm" onclick="removeMessage(${index})" title="Remove">
                <i class="ph-trash ph-bold"></i>
              </button>
            </div>
          </div>
        `;
      });
      
      elements.messageList.innerHTML = html;
    }

    function updateStats() {
      const count = state.messages.length;
      elements.totalMessages.textContent = count;
      elements.messageCount.textContent = `${count} message${count !== 1 ? 's' : ''}`;
      elements.messageCountBadge.textContent = count.toString();
      elements.tickerStatus.textContent = state.isRunning ? 'Running' : 'Stopped';
      elements.messagesShown.textContent = state.stats.messagesShown;
    }

    function updateTickerControls() {
      elements.startTickerBtn.disabled = state.isRunning;
      elements.stopTickerBtn.disabled = !state.isRunning;
      
      if (state.isRunning) {
        elements.startTickerBtn.innerHTML = '<i class="ph-spinner ph-bold animate-spin"></i> Running';
        elements.stopTickerBtn.innerHTML = '<i class="ph-stop ph-bold"></i> Stop';
      } else {
        elements.startTickerBtn.innerHTML = '<i class="ph-play ph-bold"></i> Start';
        elements.stopTickerBtn.innerHTML = '<i class="ph-stop ph-bold"></i> Stopped';
      }
    }

    function startUptimeCounter() {
      const startTime = Date.now();
      setInterval(() => {
        const elapsed = Date.now() - startTime;
        const hours = Math.floor(elapsed / 3600000);
        const minutes = Math.floor((elapsed % 3600000) / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        elements.uptime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    // Message functions
    function addMessage() {
      const messageText = elements.messageInput.value.trim();
      if (!messageText) {
        showToast('Please enter a message', 'warning');
        elements.messageInput.focus();
        return;
      }
      
      if (messageText.length > 280) {
        showToast('Message too long (max 280 characters)', 'error');
        return;
      }
      
      showLoading('Adding message...');
      if (sendWebSocketMessage('add-message', { text: messageText })) {
        // Add to history for undo functionality
        addToHistory('add_message', { message: messageText });
        
        elements.messageInput.value = '';
        showToast('Message added successfully', 'success');
        state.stats.messagesShown++;
      }
      hideLoading();
    }

    function removeMessage(index) {
      showLoading('Removing message...');
      if (sendWebSocketMessage('remove-message', { index: index })) {
        showToast('Message removed', 'success');
      }
      hideLoading();
    }

    function editMessage(index) {
      const message = state.messages[index];
      const newText = prompt('Edit message:', message.text || message);
      if (newText !== null && newText.trim()) {
        // Simple implementation - remove and add
        removeMessage(index);
        setTimeout(() => {
          elements.messageInput.value = newText.trim();
          addMessage();
        }, 100);
      }
    }

    function clearAllMessages() {
      if (state.messages.length === 0) {
        showToast('No messages to clear', 'warning');
        return;
      }
      
      if (confirm(`Clear all ${state.messages.length} messages? This action cannot be undone.`)) {
        showLoading('Clearing messages...');
        if (sendWebSocketMessage('clear-messages')) {
          showToast('All messages cleared', 'success');
        }
        hideLoading();
      }
    }

    // Ticker control functions
    function startTicker() {
      if (state.messages.length === 0) {
        showToast('Add some messages first', 'warning');
        if (state.currentView !== 'dashboard') {
          showView('dashboard');
        }
        elements.messageInput.focus();
        return;
      }
      
      const duration = parseInt(elements.durationInput.value) || 5;
      const interval = parseFloat(elements.intervalInput.value) || 0;
      
      showLoading('Starting ticker...');
      if (sendWebSocketMessage('start-ticker', { 
        duration: duration,
        interval: interval * 60 * 1000
      })) {
        showToast(`Ticker started with ${state.messages.length} messages`, 'success');
      }
      hideLoading();
    }

    function stopTicker() {
      showLoading('Stopping ticker...');
      if (sendWebSocketMessage('stop-ticker')) {
        showToast('Ticker stopped', 'success');
      }
      hideLoading();
    }

    // Quick actions
    function testOverlay() {
      showLoading('Sending test to overlay...');
      if (sendWebSocketMessage('test-overlay')) {
        showToast('Test message sent to overlay', 'info');
      }
      hideLoading();
    }

    function openOverlay() {
      const overlayUrl = `${window.location.origin}/ticker/output-enhanced`;
      window.open(overlayUrl, '_blank');
      showToast('Enhanced overlay opened in new window', 'info');
    }

    function showTestPopup() {
      const message = `Test popup - ${new Date().toLocaleTimeString()}`;
      showLoading('Showing test popup...');
      if (sendWebSocketMessage('show-popup', { 
        message: message,
        duration: 3000
      })) {
        showToast('Test popup displayed', 'info');
      }
      hideLoading();
    }

    function toggleBrb() {
      const message = 'Be Right Back - Stream will resume shortly';
      showLoading('Toggling BRB mode...');
      if (sendWebSocketMessage('start-brb', { message: message })) {
        showToast('BRB mode activated', 'info');
      }
      hideLoading();
    }

    // Quick theme application
    function applyQuickTheme(themeKey) {
      if (window.themeCustomizer) {
        window.themeCustomizer.applyPreset(themeKey);
        showToast(`Applied ${themeKey} theme`, 'success');
      }
    }

    // Event handlers
    function initEventHandlers() {
      // Form submission
      elements.messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        addMessage();
      });

      // Button clicks
      elements.startTickerBtn.addEventListener('click', startTicker);
      elements.stopTickerBtn.addEventListener('click', stopTicker);
      elements.clearAllBtn.addEventListener('click', clearAllMessages);
      elements.refreshBtn.addEventListener('click', () => {
        showLoading('Refreshing...');
        connectWebSocket();
      });
      
      elements.quickAddBtn.addEventListener('click', () => {
        showView('dashboard');
        setTimeout(() => elements.messageInput.focus(), 100);
      });

      // Quick actions
      elements.testOverlayBtn.addEventListener('click', testOverlay);
      elements.openOverlayBtn.addEventListener('click', openOverlay);
      elements.showPopupBtn.addEventListener('click', showTestPopup);
      elements.toggleBrbBtn.addEventListener('click', toggleBrb);

      // History controls
      elements.undoBtn?.addEventListener('click', undo);
      elements.redoBtn?.addEventListener('click', redo);

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Cmd/Ctrl + K for quick add
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          showView('dashboard');
          setTimeout(() => elements.messageInput.focus(), 100);
        }
        
        // Cmd/Ctrl + P for preview
        if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
          e.preventDefault();
          showView('preview');
        }
        
        // Cmd/Ctrl + T for themes
        if ((e.ctrlKey || e.metaKey) && e.key === 't') {
          e.preventDefault();
          showView('themes');
        }
        
        // Number keys for quick navigation (1-8)
        if (e.key >= '1' && e.key <= '8' && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          const views = ['dashboard', 'messages', 'ticker', 'overlay', 'popup', 'brb', 'themes', 'preview'];
          const index = parseInt(e.key) - 1;
          if (views[index]) {
            showView(views[index]);
          }
        }
        
        // Undo/Redo shortcuts
        if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
          e.preventDefault();
          undo();
        }
        
        if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
          e.preventDefault();
          redo();
        }
        
        // Escape to clear input or close mobile sidebar
        if (e.key === 'Escape') {
          if (document.activeElement === elements.messageInput) {
            elements.messageInput.value = '';
            elements.messageInput.blur();
          } else {
            elements.sidebar.classList.remove('mobile-open');
          }
        }
      });

      // Click outside sidebar to close on mobile
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768 && 
            !elements.sidebar.contains(e.target) && 
            !elements.sidebarToggle.contains(e.target)) {
          elements.sidebar.classList.remove('mobile-open');
        }
      });
    }

    // Utility functions
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Preview system initialization
    function initPreview() {
      if (!elements.previewIframe) return;

      // Set initial preview URL
      updatePreviewUrl();

      // Preview mode switching
      elements.previewModeOverlay?.addEventListener('click', () => {
        setPreviewMode('overlay');
      });
      
      elements.previewModeOptimized?.addEventListener('click', () => {
        setPreviewMode('optimized');
      });

      // Scale control
      elements.previewScale?.addEventListener('change', (e) => {
        setPreviewScale(e.target.value);
      });

      // Control buttons
      elements.previewRefreshBtn?.addEventListener('click', () => {
        refreshPreview();
      });

      elements.previewFullscreenBtn?.addEventListener('click', () => {
        openPreviewFullscreen();
      });

      // Theme selector
      elements.themeSelector?.addEventListener('change', (e) => {
        applyTheme(e.target.value);
      });

      // Monitor iframe load status
      elements.previewIframe.addEventListener('load', () => {
        updatePreviewStatus('connected', 'Live preview active');
        elements.previewStatusIndicator?.classList.add('connected');
      });

      elements.previewIframe.addEventListener('error', () => {
        updatePreviewStatus('error', 'Preview failed to load');
        elements.previewStatusIndicator?.classList.add('error');
      });

      // Set initial scale
      setPreviewScale('0.75');
    }

    function setPreviewMode(mode) {
      // Update button states
      const buttons = [elements.previewModeOverlay, elements.previewModeOptimized];
      buttons.forEach(btn => btn?.classList.remove('active'));
      
      if (mode === 'overlay') {
        elements.previewModeOverlay?.classList.add('active');
      } else {
        elements.previewModeOptimized?.classList.add('active');
      }

      updatePreviewUrl(mode);
    }

    function updatePreviewUrl(mode = 'overlay') {
      if (!elements.previewIframe) return;
      
      const urls = {
        'overlay': 'output.html',
        'optimized': 'output-optimized.html'
      };
      
      const url = urls[mode] || urls.overlay;
      elements.previewIframe.src = url;
      
      // Update direct link
      if (elements.previewDirectLink) {
        elements.previewDirectLink.textContent = `${window.location.origin}/ticker/${url}`;
      }
      
      updatePreviewStatus('connecting', 'Loading preview...');
    }

    function setPreviewScale(scale) {
      if (!elements.previewIframe) return;
      
      const frame = elements.previewIframe.closest('.preview-frame');
      if (frame) {
        frame.setAttribute('data-scale', scale);
      }
    }

    function refreshPreview() {
      if (!elements.previewIframe) return;
      
      updatePreviewStatus('connecting', 'Refreshing preview...');
      elements.previewIframe.src = elements.previewIframe.src;
    }

    function openPreviewFullscreen() {
      if (!elements.previewIframe) return;
      
      const url = elements.previewIframe.src;
      window.open(url, '_blank', 'width=1920,height=1080,scrollbars=no,resizable=yes');
    }

    function updatePreviewStatus(status, text) {
      if (elements.previewStatusDot) {
        elements.previewStatusDot.className = `status-dot ${status}`;
      }
      
      if (elements.previewStatusText) {
        elements.previewStatusText.textContent = text;
      }
    }

    // Theme system
    function applyTheme(themeName) {
      const body = document.body;
      const html = document.documentElement;
      // Remove existing theme classes
      const themeClasses = ['theme-dark', 'theme-glass', 'theme-cyberpunk', 'theme-professional'];
      themeClasses.forEach(cls => {
        body.classList.remove(cls);
        html.classList.remove(cls);
      });
      // Apply new theme
      const themeClass = `theme-${themeName}`;
      html.classList.add(themeClass);
      body.classList.add(themeClass);
      // Save theme preference
      localStorage.setItem('ticker-theme', themeName);
      showToast(`Theme changed to ${themeName}`, 'success');
    }

    function loadSavedTheme() {
      const savedTheme = localStorage.getItem('ticker-theme') || 'dark';
      if (elements.themeSelector) {
        elements.themeSelector.value = savedTheme;
      }
      applyTheme(savedTheme);
    }

    // History/Undo system
    function addToHistory(action, data) {
      // Remove any future history if we're not at the end
      state.history.stack = state.history.stack.slice(0, state.history.currentIndex + 1);
      
      // Add new action
      state.history.stack.push({ action, data, timestamp: Date.now() });
      state.history.currentIndex++;
      
      // Trim history if too large
      if (state.history.stack.length > state.history.maxSize) {
        state.history.stack.shift();
        state.history.currentIndex--;
      }
      
      updateHistoryControls();
    }
    
    function undo() {
      if (state.history.currentIndex >= 0) {
        const item = state.history.stack[state.history.currentIndex];
        executeHistoryAction(item, true);
        state.history.currentIndex--;
        updateHistoryControls();
      }
    }
    
    function redo() {
      if (state.history.currentIndex < state.history.stack.length - 1) {
        state.history.currentIndex++;
        const item = state.history.stack[state.history.currentIndex];
        executeHistoryAction(item, false);
        updateHistoryControls();
      }
    }
    
    function executeHistoryAction(item, isUndo) {
      switch (item.action) {
        case 'add_message':
          if (isUndo) {
            state.messages = state.messages.filter(msg => msg !== item.data.message);
          } else {
            state.messages.push(item.data.message);
          }
          break;
        case 'remove_message':
          if (isUndo) {
            state.messages.splice(item.data.index, 0, item.data.message);
          } else {
            state.messages = state.messages.filter(msg => msg !== item.data.message);
          }
          break;
        case 'theme_change':
          applyTheme(isUndo ? item.data.oldTheme : item.data.newTheme);
          break;
      }
      updateMessageDisplay();
    }
    
    function updateHistoryControls() {
      if (elements.undoBtn) {
        elements.undoBtn.disabled = state.history.currentIndex < 0;
      }
      if (elements.redoBtn) {
        elements.redoBtn.disabled = state.history.currentIndex >= state.history.stack.length - 1;
      }
      if (elements.historyIndicator) {
        const total = state.history.stack.length;
        const current = state.history.currentIndex + 1;
        elements.historyIndicator.textContent = total > 0 ? `${current}/${total}` : 'No changes';
      }
    }

    // Logo management
    function initLogoUpload() {
      if (!elements.logoUploadArea) return;
      
      // File input handling
      elements.logoFileInput?.addEventListener('change', handleLogoFile);
      
      // Drag and drop
      elements.logoUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        elements.logoUploadArea.classList.add('dragover');
      });
      
      elements.logoUploadArea.addEventListener('dragleave', () => {
        elements.logoUploadArea.classList.remove('dragover');
      });
      
      elements.logoUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        elements.logoUploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleLogoFile({ target: { files } });
        }
      });
      
      // Click to upload
      elements.logoUploadArea.addEventListener('click', () => {
        elements.logoFileInput?.click();
      });
      
      // Logo controls
      elements.logoRemoveBtn?.addEventListener('click', removeLogo);
      elements.logoRepositionBtn?.addEventListener('click', toggleLogoPositioning);
    }
    
    function handleLogoFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validate file
      if (!file.type.startsWith('image/')) {
        showToast('Please select an image file', 'error');
        return;
      }
      
      if (file.size > 2 * 1024 * 1024) {
        showToast('Logo file must be under 2MB', 'error');
        return;
      }
      
      // Read and display
      const reader = new FileReader();
      reader.onload = (e) => {
        state.logo.url = e.target.result;
        displayLogo();
        showToast('Logo uploaded successfully', 'success');
      };
      reader.readAsDataURL(file);
    }
    
    function displayLogo() {
      if (elements.logoPreview && state.logo.url) {
        elements.logoPreview.src = state.logo.url;
        elements.logoPreview.style.display = 'block';
        elements.logoControls.style.display = 'flex';
        
        // Hide upload content
        const uploadContent = document.getElementById('logoUploadContent');
        if (uploadContent) uploadContent.style.display = 'none';
      }
    }
    
    function removeLogo() {
      state.logo.url = null;
      if (elements.logoPreview) {
        elements.logoPreview.style.display = 'none';
        elements.logoControls.style.display = 'none';
        
        // Show upload content
        const uploadContent = document.getElementById('logoUploadContent');
        if (uploadContent) uploadContent.style.display = 'block';
      }
      showToast('Logo removed', 'success');
    }
    
    function toggleLogoPositioning() {
      const settings = elements.logoPositionSettings;
      if (settings) {
        settings.style.display = settings.style.display === 'none' ? 'block' : 'none';
      }
    }

    // Theme management functions
    function applyPresetTheme(themeName) {
      const oldTheme = getCurrentTheme();
      applyTheme(themeName);
      addToHistory('theme_change', { oldTheme, newTheme: themeName });
      
      // Update theme selector
      if (elements.themeSelector) {
        elements.themeSelector.value = themeName;
      }
      
      // Update preset card states
      document.querySelectorAll('.theme-preset-card').forEach(card => {
        card.classList.toggle('active', card.dataset.theme === themeName);
      });
    }
    
    function getCurrentTheme() {
      const html = document.documentElement;
      for (const className of html.classList) {
        if (className.startsWith('theme-')) {
          return className.replace('theme-', '');
        }
      }
      return 'dark';
    }

    // Help system
    function toggleHelp(helpId) {
      const helpPanel = document.getElementById(helpId);
      if (helpPanel) {
        helpPanel.classList.toggle('active');
      }
    }

    // Initialize dashboard
    function init() {
      initNavigation();
      initEventHandlers();
      initPreview();
      initLogoUpload();
      updateHistoryControls();
      loadSavedTheme();
      connectWebSocket();
      updateTickerControls();
      updateStats();
      
      // Show welcome message
      setTimeout(() => {
        showToast('Dashboard loaded successfully', 'success');
      }, 500);
    }

    // Start when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>