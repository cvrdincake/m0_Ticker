<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M0 Ticker - Dashboard</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="css/widgets.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h1 class="dashboard-title">M0 Ticker Control</h1>
      <p class="dashboard-subtitle">Professional streaming widget management</p>
      
      <!-- Connection Status -->
      <div id="connection-status" class="glass-status">
        <span class="status-indicator" id="status-dot"></span>
        <span id="status-text">Connecting...</span>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      
      <!-- Ticker Widget -->
      <div class="widget-card" data-widget="ticker">
        <div class="widget-header">
          <h3 class="widget-title">üì± Ticker Messages</h3>
          <div class="widget-status" id="ticker-status">
            <span class="status-badge inactive">INACTIVE</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="ticker-text" class="form-label">Message Text</label>
          <textarea 
            id="ticker-text" 
            class="form-input" 
            placeholder="Enter your ticker message..."
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="ticker-speed" class="form-label">Animation Speed</label>
          <div class="range-group">
            <input 
              type="range" 
              id="ticker-speed" 
              class="range-input"
              min="5" 
              max="50" 
              value="15"
            >
            <span class="range-value" id="ticker-speed-value">15s</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="ticker-theme" class="form-label">Visual Theme</label>
          <div class="theme-grid">
            <div class="theme-option theme-dark active" data-theme="dark">Dark</div>
            <div class="theme-option theme-light" data-theme="light">Light</div>
            <div class="theme-option theme-blue" data-theme="blue">Blue</div>
            <div class="theme-option theme-purple" data-theme="purple">Purple</div>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="showTicker()">Show Ticker</button>
          <button class="btn btn-secondary" onclick="hideTicker()">Hide Ticker</button>
        </div>
      </div>
      
      <!-- Popup Widget -->
      <div class="widget-card" data-widget="popup">
        <div class="widget-header">
          <h3 class="widget-title">üí¨ Popup Notifications</h3>
          <div class="widget-status" id="popup-status">
            <span class="status-badge inactive">INACTIVE</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="popup-title" class="form-label">Popup Title</label>
          <input 
            type="text" 
            id="popup-title" 
            class="form-input" 
            placeholder="Enter popup title..."
          >
        </div>
        
        <div class="form-group">
          <label for="popup-message" class="form-label">Message Content</label>
          <textarea 
            id="popup-message" 
            class="form-input" 
            placeholder="Enter your message..."
            rows="4"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="popup-duration" class="form-label">Display Duration</label>
          <div class="range-group">
            <input 
              type="range" 
              id="popup-duration" 
              class="range-input"
              min="3" 
              max="30" 
              value="10"
            >
            <span class="range-value" id="popup-duration-value">10s</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="showPopup()">Show Popup</button>
          <button class="btn btn-secondary" onclick="hidePopup()">Hide Popup</button>
        </div>
      </div>
      
      <!-- BRB Widget -->
      <div class="widget-card" data-widget="brb">
        <div class="widget-header">
          <h3 class="widget-title">‚è∞ Be Right Back</h3>
          <div class="widget-status" id="brb-status">
            <span class="status-badge inactive">INACTIVE</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="brb-title" class="form-label">BRB Title</label>
          <input 
            type="text" 
            id="brb-title" 
            class="form-input" 
            placeholder="Be Right Back"
            value="Be Right Back"
          >
        </div>
        
        <div class="form-group">
          <label for="brb-message" class="form-label">Custom Message</label>
          <textarea 
            id="brb-message" 
            class="form-input" 
            placeholder="Taking a quick break, back soon!"
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="brb-icon" class="form-label">Icon</label>
          <select id="brb-icon" class="form-input">
            <option value="‚òï">‚òï Coffee</option>
            <option value="üçï">üçï Food</option>
            <option value="üöΩ">üöΩ Bathroom</option>
            <option value="üìû">üìû Phone Call</option>
            <option value="‚è∞">‚è∞ Clock</option>
            <option value="üéÆ">üéÆ Gaming</option>
          </select>
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="showBRB()">Show BRB</button>
          <button class="btn btn-secondary" onclick="hideBRB()">Hide BRB</button>
        </div>
      </div>
      
      <!-- System Control -->
      <div class="widget-card" data-widget="system">
        <div class="widget-header">
          <h3 class="widget-title">‚öôÔ∏è System Control</h3>
          <div class="widget-status">
            <span class="status-badge active">ONLINE</span>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Quick Actions</label>
          <div class="button-group">
            <button class="btn btn-outline" onclick="hideAllWidgets()">Hide All</button>
            <button class="btn btn-outline" onclick="testConnection()">Test Connection</button>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Widget State</label>
          <div class="widget-states">
            <div class="state-item">
              <span>Ticker:</span>
              <span id="ticker-state" class="state-value">Hidden</span>
            </div>
            <div class="state-item">
              <span>Popup:</span>
              <span id="popup-state" class="state-value">Hidden</span>
            </div>
            <div class="state-item">
              <span>BRB:</span>
              <span id="brb-state" class="state-value">Hidden</span>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Server Status</label>
          <div class="server-info">
            <div class="info-item">
              <span>WebSocket:</span>
              <span id="ws-status" class="info-value">Connecting...</span>
            </div>
            <div class="info-item">
              <span>Output Page:</span>
              <a href="output.html" target="_blank" class="link">Open in New Tab</a>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/websocket-client.js"></script>
  <script src="js/dashboard-controller.js"></script>
  
  <script>
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Dashboard loading...');
      
      // Initialize range inputs
      setupRangeInputs();
      
      // Initialize theme selectors
      setupThemeSelectors();
      
      // Initialize WebSocket
      if (typeof WebSocketClient !== 'undefined') {
        const ws = new WebSocketClient();
        window.wsClient = ws;
        console.log('WebSocket client initialized');
      }
      
      // Initialize dashboard controller
      if (typeof DashboardController !== 'undefined') {
        const dashboard = new DashboardController(window.wsClient);
        window.dashboardController = dashboard;
        console.log('Dashboard controller initialized');
      }
      
      console.log('Dashboard ready');
    });
    
    // Range input handlers
    function setupRangeInputs() {
      const ranges = document.querySelectorAll('.range-input');
      ranges.forEach(range => {
        const valueDisplay = document.getElementById(range.id + '-value');
        if (valueDisplay) {
          range.addEventListener('input', function() {
            valueDisplay.textContent = this.value + 's';
          });
        }
      });
    }
    
    // Theme selector handlers
    function setupThemeSelectors() {
      const themes = document.querySelectorAll('.theme-option');
      themes.forEach(theme => {
        theme.addEventListener('click', function() {
          // Remove active from siblings
          this.parentNode.querySelectorAll('.theme-option').forEach(t => t.classList.remove('active'));
          // Add active to this
          this.classList.add('active');
        });
      });
    }
    
    // Widget control functions
    function showTicker() {
      const text = document.getElementById('ticker-text').value;
      const speed = document.getElementById('ticker-speed').value;
      const theme = document.querySelector('.theme-option.active')?.dataset.theme || 'dark';
      
      if (window.dashboardController) {
        window.dashboardController.showTicker(text, { speed, theme });
      }
    }
    
    function hideTicker() {
      if (window.dashboardController) {
        window.dashboardController.hideTicker();
      }
    }
    
    function showPopup() {
      const title = document.getElementById('popup-title').value;
      const message = document.getElementById('popup-message').value;
      const duration = document.getElementById('popup-duration').value;
      
      if (window.dashboardController) {
        window.dashboardController.showPopup(title, message, { duration });
      }
    }
    
    function hidePopup() {
      if (window.dashboardController) {
        window.dashboardController.hidePopup();
      }
    }
    
    function showBRB() {
      const title = document.getElementById('brb-title').value;
      const message = document.getElementById('brb-message').value;
      const icon = document.getElementById('brb-icon').value;
      
      if (window.dashboardController) {
        window.dashboardController.showBRB(title, message, { icon });
      }
    }
    
    function hideBRB() {
      if (window.dashboardController) {
        window.dashboardController.hideBRB();
      }
    }
    
    function hideAllWidgets() {
      if (window.dashboardController) {
        window.dashboardController.hideAll();
      }
    }
    
    function testConnection() {
      if (window.wsClient) {
        window.wsClient.send({
          event: 'test',
          data: { message: 'Dashboard connection test' }
        });
      }
    }
  </script>
</body>
</html>